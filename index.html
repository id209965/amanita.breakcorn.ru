<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Œõ V X T V</title>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <!-- Yandex.Metrika counter -->
  <script type="text/javascript" >
     (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
     m[i].l=1*new Date();
     for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
     k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
     (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

     ym(98476998, "init", {
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true,
          webvisor:true
     });
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/98476998" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->
  <style>
    html, body {
      height: 100%; width: 100%;
      margin: 0; padding: 0;
    }
    .plyr__video-embed {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>

<div id="PLAYER" data-plyr-provider="youtube" data-plyr-embed-id="rKyBID8kPWY"></div>

<!-- Autoplay Dialog -->
<div id="autoplayDialog" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.9); color: white; padding: 30px; border-radius: 10px; text-align: center; z-index: 10000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);">
  <h2 style="margin-top: 0; font-size: 24px;">üé¨ –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ?</h2>
  <p style="font-size: 16px; margin-bottom: 25px; opacity: 0.9;">–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ–æ –Ω–∞—á–∏–Ω–∞–ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?</p>
  <div style="display: flex; gap: 15px; justify-content: center;">
    <button id="autoplayAllow" style="background: #4CAF50; color: white; border: none; padding: 12px 24px; border-radius: 5px; font-size: 16px; cursor: pointer;">‚úì –î–∞, –≤–∫–ª—é—á–∏—Ç—å</button>
    <button id="autoplayDeny" style="background: #f44336; color: white; border: none; padding: 12px 24px; border-radius: 5px; font-size: 16px; cursor: pointer;">‚úó –ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ</button>
  </div>
  <p style="font-size: 12px; margin-top: 20px; margin-bottom: 0; opacity: 0.7;">–í—ã–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
</div>

<!-- History Window -->
<div id="historyWindow" style="position: fixed; top: 20px; right: 20px; width: 300px; max-height: 400px; background: rgba(0, 0, 0, 0.8); color: white; border-radius: 8px; padding: 15px; z-index: 9999; display: none; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <h3 style="margin: 0; font-size: 16px;">üì∫ –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</h3>
    <button id="toggleHistory" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">√ó</button>
  </div>
  <div id="historyContent" style="max-height: 320px; overflow-y: auto;"></div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script><script>
const videos = [ // –ú–∞—Å—Å–∏–≤ —Å –≤–∏–¥–µ–æ-—Å—Å—ã–ª–∫–∞–º–∏ (YouTube –∏ Vimeo)
  // YouTube
  { type: 'yt', id: 'tL6ZTcrDPAU' }, // Duke Ellington. Caravan
  { type: 'yt', id: '-tgKpW06mWU' }, // –ü–æ—Å–ª–µ–¥–Ω–∏–π –ï–¥–∏–Ω–æ—Ä–æ–≥ - –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, –§—ç–Ω—Ç–µ–∑–∏, 1982 - –°–º–æ—Ç—Ä–µ—Ç—å –º—É–ª—å—Ç—Ñ–∏–ª—å–º—ã
  { type: 'yt', id: 'PrAczNE7OIo' }, // –ó–∞–≥–∞–¥–æ—á–Ω–∞—è –ø–ª–∞–Ω–µ—Ç–∞. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º (1974)
  { type: 'yt', id: 'Bhsi7YgXlCA' }, // –ù–µ–∑–Ω–∞–π–∫–∞ - –≤—Å–µ —Å–µ—Ä–∏–∏
  { type: 'yt', id: 'volnH_bKpqk' }, // –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –ë—É—Ä–∞—Ç–∏–Ω–æ. –°–±–æ—Ä–Ω–∏–∫ –ø–µ—Å–µ–Ω –∏–∑ —Ñ–∏–ª—å–º–∞ (1975)
  { type: 'yt', id: 'Jnl6Jf4yiu8' }, // –ü–µ—Å–Ω—è "–ö—Ä—ã–ª–∞—Ç—ã–µ –∫–∞—á–µ–ª–∏" –∏–∑ —Ñ–∏–ª—å–º–∞ "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" (1979)
  { type: 'yt', id: 'DRYzImN_bDM' }, // –ü—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ –¥–∞–ª–µ–∫–æ - –ø–µ—Å–Ω—è –∏–∑ –∫/—Ñ –ì–æ—Å—Ç—å—è –∏–∑ –±—É–¥—É—â–µ–≥–æ (1985)
  { type: 'yt', id: 'tay19RVx2fw' }, // –¢—Ä—è–º! –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–æ–±—Ä—ã–π —Å–æ–≤–µ—Ç—Å–∫–∏–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º –ø—Ä–æ —ë–∂–∏–∫–∞ –∏ –º–µ–¥–≤–µ–∂–æ–Ω–∫–∞ (1980)
  { type: 'yt', id: 'sStuI47cE_4' }, // –ú–æ–π–¥–æ–¥—ã—Ä üí™ –î–µ—Ç—Å–∫–∞—è —Å–∫–∞–∑–∫–∞ –≤ —Å—Ç–∏—Ö–∞—Ö üíé –ó–æ–ª–æ—Ç–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –°–æ—é–∑–º—É–ª—å—Ç—Ñ–∏–ª—å–º HD
  { type: 'yt', id: 'LbOve_UZZ54' }, // –ü–æ –ø–æ–ª—è–º –°–∏–Ω–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä –µ–¥–µ—Ç –∫ –Ω–∞–º - –ü–µ—Å–µ–Ω–∫–∞ –º—É–ª—å—Ç–∏–∫ –¥–ª—è –¥–µ—Ç–µ–π
  { type: 'yt', id: 'B9QtYhVBrZ4' }, // –°–∫–∞–∑–∫–∞ –¶–≤–µ—Ç–∏–∫-—Å–µ–º–∏—Ü–≤–µ—Ç–∏–∫ - –ó–æ–ª–æ—Ç–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –°–æ—é–∑–º—É–ª—å—Ç—Ñ–∏–ª—å–º
  { type: 'yt', id: 'oDbLk7xMS2Y' }, // koshkin dom 1958
  { type: 'yt', id: 'la7hwRw6SbY' }, // –ú–∞–º–∞ –¥–ª—è –º–∞–º–æ–Ω—Ç–µ–Ω–∫–∞. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º (1981)
  { type: 'yt', id: 'BTWjS1qm9bM' }, // –ü–µ—Å–Ω—è "–ê –º–æ–∂–µ—Ç" –∏–∑ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–∞ "–ü–ª–∞—Å—Ç–∏–ª–∏–Ω–æ–≤–∞—è –≤–æ—Ä–æ–Ω–∞" (1981)
  { type: 'yt', id: '71B2if-6EgE' }, // –ö–æ—Ä–æ–±–∫–∞ —Å –∫–∞—Ä–∞–Ω–¥–∞—à–∞–º–∏. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º (1985)
  { type: 'yt', id: 'Uf1HoaM6ujo' }, // –£–º–Ω–∞—è —Å–æ–±–∞—á–∫–∞ –°–æ–Ω—è. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º (1991)
  { type: 'yt', id: '-LuLoresKPg' }, // –ö—Ä–æ—à–∫–∞ –ï–Ω–æ—Ç. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º (1974)
  { type: 'yt', id: 'EbP2zDza12g' }, // –ö–æ—Ç –∏ –õ–∏—Å–∞ - –°–∫–∞–∑–∫–∞ –¥–ª—è –¥–µ—Ç–µ–π - –ú—É–ª—å—Ç–∏–∫–∏ HD
  { type: 'yt', id: 'gMk_M96bGDM' }, // –ö—Ä–æ—à–µ—á–∫–∞-–•–∞–≤—Ä–æ—à–µ—á–∫–∞ | –†—É—Å—Å–∫–∞—è —Å–∫–∞–∑–∫–∞ | –º—É–ª—å—Ç–∫ –¥–ª—è –¥–µ—Ç–µ–π | Kroshechka Khavroshechka | Kids Tv Russia
  { type: 'yt', id: 'GCXLxkU0x2I' }, // –ö–æ–ª–æ–±–æ–∫ | —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–µ –≤–∏–¥–µ–æ | —Ä—É—Å—Å–∫–∏–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º | –¥–µ—Ç–∏ –≤–∏–¥–µ–æ | Kolobok | Russian Kids Stories
  { type: 'yt', id: 'q4x5u0Xn0oA' }, // –°–∏–Ω–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç | –ù–∞—Å–µ–∫–æ–º—ã–µ | –ü–µ—Å–µ–Ω–∫–∏ –º—É–ª—å—Ç–∏–∫–∏ –¥–ª—è –¥–µ—Ç–µ–π
  { type: 'yt', id: '1m8IyfG925Q' }, // Baby Shark Dance | Baile del Tibur√≥n Beb√© | Pinkfong Canciones Infantiles
  { type: 'yt', id: 'rfrvlF2t6t4' }, // –ú—É–ª—å—Ç—Ñ–∏–ª—å–º –°–°–°–† "–ü–µ—Ç—è –∏ –ö—Ä–∞—Å–Ω–∞—è —à–∞–ø–æ—á–∫–∞" 1958 –≥–æ–¥.
  { type: 'yt', id: 'ix66VKwPPu4' }, // –ö–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥—É–ª—è–ª —Å–∞–º –ø–æ —Å–µ–±–µ (1968 –≥–æ–¥) –º—É–ª—å—Ç—Ñ–∏–ª—å–º
  { type: 'yt', id: 'bCtlituS9p8' }, // Tom & Jerry | Trouble Everywhere | Classic Cartoon Compilation | WB Kids
  { type: 'yt', id: 'ifERvQbIv8o' }, // Bugs Bunny Builders | Coyote Is Done with the Beep Beep | ‚Ä™@wbkids‚Ä¨ 
  { type: 'yt', id: 'JmG0pHyZP3E' }, // Bugs Bunny Builders | Rock On! | ‚Ä™@wbkids‚Ä¨ 
  { type: 'yt', id: 'vQHW4vORqRw' }, // –ö–æ—Ç –õ–µ–æ–ø–æ–ª—å–¥. –°–µ—Ä–∏—è 10. –ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ –∫–æ—Ç–∞ –õ–µ–æ–ø–æ–ª—å–¥–∞ (1986)
  { type: 'yt', id: 'CErf41K1tTI' }, // –ú–µ—Å—Ç—å –∫–æ—Ç–∞ –õ–µ–æ–ø–æ–ª—å–¥–∞. –°–µ—Ä–∏—è 1. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º (1975)
  { type: 'yt', id: 'mPKsyTqwjlg' }, // –¢–∞–±–ª–∏—Ü–∞ –£–ú–ù–û–ñ–ï–ù–ò–Ø –≤ —Å—Ç–∏—Ö–∞—Ö - –∑–∞–ø–æ–º–Ω–∏—Ç–µ –Ω–∞ —Ä–∞–∑ - –¥–≤–∞!
  { type: 'yt', id: 'AfXS1EUxzZE' }, // –ú–∞—à–∞ –∏ –õ–µ–æ–ø–æ–ª—å–¥. –ü—ã–ª–µ—Å–æ—Å —ç–º–æ—Ü–∏–π - –°–µ—Ä–∏–∏ –¥–ª—è –≤—Å–µ–π —Å–µ–º—å–∏ - Lion Family –Ω–∞ —Ä—É—Å—Å–∫–æ–º -–ú—É–ª—å—Ç–∏–∫
  { type: 'yt', id: '5a6pDc-U294' }, // –ê–∑–±—É–∫–∞_–ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –í–°–ï —Å–µ—Ä–∏–∏ - –°–º–µ—à–∞—Ä–∏–∫–∏ 2D
  { type: 'yt', id: 'puEbWbLq8IA' }, // –£—á–∏–º –ø–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞ –ó–∞–ø—É—Å–∫ —Ä–µ—á–∏ –ù–æ–≤—ã–π –≤—ã–ø—É—Å–∫
  { type: 'yt', id: 'YETVZJMFK6c' }, // –û—Ö –∏ –ê—Ö ‚óè –í—Å–µ —Å–µ—Ä–∏–∏ –ø–æ–¥—Ä—è–¥ ‚óè –°–±–æ—Ä–Ω–∏–∫ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–≤
  { type: 'yt', id: '9hDjp0C79-c' }, // –ü–∞–¥–∞–ª –ø—Ä–æ—à–ª–æ–≥–æ–¥–Ω–∏–π —Å–Ω–µ–≥. –°–æ–≤–µ—Ç—Å–∫–∏–π –ø–ª–∞—Å—Ç–∏–ª–∏–Ω–æ–≤—ã–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º (1983)
  { type: 'yt', id: 'BihaXNoR9J0' }, // –°–ª–µ–¥—Å—Ç–≤–∏–µ –≤–µ–¥—É—Ç –ö–æ–ª–æ–±–∫–∏. –í—Å–µ —Å–µ—Ä–∏–∏ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–∞ (1986)
  { type: 'yt', id: 'ak044vR5_yc' }, // –ó–∞–π—Ü–∞ –Ω–µ –≤–∏–¥–∞–ª–∏? –ú—É–ª—å—Ç—Ñ–∏–ª—å–º (1985)
  { type: 'yt', id: 'aTkfgOPDjq0' }, // –ú –ú–∞–≥–æ–º–∞–µ–≤ –õ—É—á –°–æ–ª–Ω—Ü–∞ –ó–æ–ª–æ—Ç–æ–≥–æ
  { type: 'yt', id: '9KxZDFIy2n4' }, // –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–Ω–∞ –í—Ä—É–Ω–≥–µ–ª—è. –ü–µ—Å–Ω—è "–ú—ã –±–∞–Ω–¥–∏—Ç–æ" (1979)
  { type: 'yt', id: 'v5vdc-HfEEA' }, // –ö–æ–Ω—Ç–∞–∫—Ç –º—É–ª—å—Ç—Ñ–∏–ª—å–º –°–°–°–† 1978
  { type: 'yt', id: 'LQiuImJmceI' }, // —á–∏–ø –∏ –î–µ–π–ª —Å–ø–µ—à–∞—Ç –Ω–∞ –ø–æ–º–æ—â—å 3 —Å–µ—Ä–∏—è
  { type: 'yt', id: 'uZOxM7YB3AU' }, // –ì—É–±–∫–∞ –ë–æ–± –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –®—Ç–∞–Ω—ã | –ö—Ä–∞–±–±–∏–ª–µ–Ω–¥ | –ü–æ–ª–Ω—ã–π —ç–ø–∏–∑–æ–¥ | Nickelodeon –†–æ—Å—Å–∏—è
  { type: 'yt', id: 'vSufNvOtw8Q' }, // –í–∏–Ω–Ω–∏ –ü—É—Ö (–Ω–∞ —Ä—É—Å—Å–∫–æ–º) –ú–µ–¥–æ–≤—ã–π –ø–∏—Ä
  { type: 'yt', id: 'MRq4qZM8kRg' }, // –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–Ω–∞ –í—Ä—É–Ω–≥–µ–ª—è. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º. –í—Å–µ —Å–µ—Ä–∏–∏ (1976-79)
  { type: 'yt', id: '-VfZ6Tdx0fY' }, // –¢–∞–π–Ω–∞ —Ç—Ä–µ—Ç—å–µ–π –ø–ª–∞–Ω–µ—Ç—ã. –ê–ª–∏—Å–∞ –°–µ–ª–µ–∑–Ω—ë–≤–∞. –ê–ª–∏—Å–∞. –ó–µ–ª—ë–Ω—ã–π. –ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä. –®—Ç—É—Ä–º–∞–Ω. –ë–∞—Å–æ–≤.
  { type: 'yt', id: 'vWtOqPGWtkw' }, // –§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º - –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –ê–ª–∏—Å—ã
  { type: 'yt', id: 'EbO_4oVE3pg' }, // –ê–ª–∏—Å–∞ –≤ —Å—Ç—Ä–∞–Ω–µ —á—É–¥–µ—Å. –í—Å–µ —Å–µ—Ä–∏–∏. –ú—É–ª—å—Ç—Ñ–∏–ª—å–º –ø–æ –º–æ—Ç–∏–≤–∞–º —Å–∫–∞–∑–∫–∏ –õ—å—é–∏—Å–∞ –ö—ç—Ä—Ä–æ–ª–ª–∞ (1981)
  { type: 'yt', id: 'hMe2uS6m7EM' }, // –¢–∞–π–Ω–∞ —Ç—Ä–µ—Ç—å–µ–π –ø–ª–∞–Ω–µ—Ç—ã (–Ω–µ–π—Ä–æ—Å–µ—Ç—å Midjourney)
  { type: 'yt', id: 'xMQhq5LR1fk' }, // –ñ–∏–ª –ë—ã–ª –ü–µ—Å: –ò—Å—Ç–æ—Ä–∏—è –°–æ–∑–¥–∞–Ω–∏—è –®–ï–î–ï–í–†–ê –°–æ–≤–µ—Ç—Å–∫–æ–π –ê–Ω–∏–º–∞—Ü–∏–∏
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  // { type: 'yt', id: '' },
  
  // Vimeo –¥–ª—è —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏—è —Å YouTube (–ø–æ–º–æ–≥–∞–µ—Ç —Å –æ—á–∏—Å—Ç–∫–æ–π –ø–∞–º—è—Ç–∏)
  { type: 'vi', id: '162736398' }, // Nature documentary
  { type: 'vi', id: '56282283' },  // Short film
  { type: 'vi', id: '148751763' }, // Animation
  { type: 'vi', id: '125095515' } // Art/Creative
];
let currentIndex = 0; // –¢–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å –≤–∏–¥–µ–æ

// Make variables accessible to tests by exposing them on window
window.currentVideoIndex = 0;
window.videoCount = videos.length;
window.consecutiveFailures = 0;
const container = document.getElementById('PLAYER');
let player = null;
let videoChangeCount = 0;
const MAX_VIDEOS_BEFORE_RECREATE = 20; // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –ø–ª–µ–µ—Ä –∫–∞–∂–¥—ã–µ 20 –≤–∏–¥–µ–æ (—É–≤–µ–ª–∏—á–∏–ª–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
let memoryCheckInterval;
let lastProvider = null; // –ü–æ—Å–ª–µ–¥–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
const PREFER_PROVIDER_ALTERNATION = false; // –û—Ç–∫–ª—é—á–µ–Ω–æ - –Ω–µ –º–µ—à–∞–µ–º –º–æ–Ω–æ–∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
let consecutiveFailures = 0;

// Constants will be exposed to window after they are all defined

// Function to sync window variables with local variables
function syncWindowVariables() {
  window.currentVideoIndex = currentIndex;
  window.consecutiveFailures = consecutiveFailures;
  window.videoCount = videos.length;
  // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
  window.currentVideo = (currentIndex >= 0 && currentIndex < videos.length) ? videos[currentIndex] : null;
  window.missingVideoCount = missingVideoCount;
  window.needsPlayerRecovery = needsPlayerRecovery;
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–ª–µ–µ—Ä –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
  window.player = player;
}

// Expose videos array on window
window.videos = videos;

// Function to expose all functions on window for tests
function exposeFunctionsToWindow() {
  // Expose existing functions
  window.logMemoryUsage = logMemoryUsage;
  window.startWatchdog = startWatchdog;
  window.stopWatchdog = stopWatchdog;
  window.createPlayer = createPlayer;
  
  // Create aliases for functions with different names
  window.loadNextVideo = forceNextVideo;
  window.cleanupPlayer = destroyPlayer;
  window.handleVideoError = handleVideoFailure;
  
  // Expose new keyboard control functions
  window.togglePlayPause = togglePlayPause;
  window.loadRandomVideo = loadRandomVideo;
  window.goBackInHistory = goBackInHistory;
  
  // Expose video recovery functions for debugging
  window.tryRestoreVideoDisplay = tryRestoreVideoDisplay;
  window.tryRecreateIframe = tryRecreateIframe;
  window.tryFullPlayerRecreation = tryFullPlayerRecreation;
  
  // Expose player settings for testing
  window.playerSettings = playerSettings;
  
  // Create missing functions that tests expect
  window.checkVideoProgress = function() {
    if (player && player.currentTime !== undefined && player.duration !== undefined) {
      return {
        currentTime: player.currentTime,
        duration: player.duration,
        progress: player.duration > 0 ? player.currentTime / player.duration : 0
      };
    }
    return { currentTime: 0, duration: 0, progress: 0 };
  };
  
  window.handleLoadTimeout = function() {
    console.warn('Load timeout triggered by test');
    handleVideoFailure('test_timeout');
  };
}
const MAX_CONSECUTIVE_FAILURES = 3;
let currentVideoTimeout = null;
const VIDEO_LOAD_TIMEOUT = 15000; // 15 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
let isRecovering = false;
let watchdogInterval = null;
let lastCurrentTime = -1;
let stuckTimeCount = 0;
let zeroTimeCount = 0; // –°—á–µ—Ç—á–∏–∫ –¥–ª—è currentTime = 0
let missingVideoCount = 0; // –°—á–µ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç–∞
let needsPlayerRecovery = false; // –§–ª–∞–≥ —á—Ç–æ –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∏–¥–µ–æ
const WATCHDOG_CHECK_INTERVAL = 15000; // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ (–º–µ–Ω–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ)
const WATCHDOG_FAST_INTERVAL = 10000; // –£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
const MAX_STUCK_CHECKS = 12; // 12 –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–æ–¥—Ä—è–¥ = 180 —Å–µ–∫—É–Ω–¥ (3 –º–∏–Ω—É—Ç—ã) –±–µ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
const MAX_ZERO_TIME_CHECKS = 8; // 8 –ø—Ä–æ–≤–µ—Ä–æ–∫ = 120 —Å–µ–∫—É–Ω–¥ (2 –º–∏–Ω—É—Ç—ã) –Ω–∞ currentTime=0

// Autoplay and History System
class VideoPlayerSettings {
  constructor() {
    this.AUTOPLAY_KEY = 'videoPlayerAutoplay';
    this.HISTORY_KEY = 'videoPlayerHistory';
    this.historySize = this.getHistorySize();
    this.watchHistory = this.loadHistory();
    this.autoplayAllowed = this.getAutoplayPreference();
    this.historyPosition = 0; // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ (0 = –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∏–¥–µ–æ)
  }

  getHistorySize() {
    const urlParams = new URLSearchParams(window.location.search);
    const size = urlParams.get('historySize') || urlParams.get('history');
    return size ? parseInt(size) : Infinity;
  }

  setAutoplayPreference(allowed) {
    this.autoplayAllowed = allowed;
    localStorage.setItem(this.AUTOPLAY_KEY, allowed ? 'true' : 'false');
  }

  getAutoplayPreference() {
    const stored = localStorage.getItem(this.AUTOPLAY_KEY);
    return stored === null ? null : stored === 'true';
  }

  addToHistory(videoId, title = null, writeToCache = true) {
    // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
    this.watchHistory = this.watchHistory.filter(item => item.id !== videoId);
    this.watchHistory.unshift({
      id: videoId,
      title: title || videoId,
      timestamp: Date.now()
    });
    if (this.watchHistory.length > this.historySize) {
      this.watchHistory = this.watchHistory.slice(0, this.historySize);
    }
    this.historyPosition = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ
    if (writeToCache) {
      this.saveHistory();
    }
    this.updateHistoryUI();
  }

  loadHistory() {
    try {
      const stored = localStorage.getItem(this.HISTORY_KEY);
      return stored ? JSON.parse(stored) : [];
    } catch (e) {
      return [];
    }
  }

  saveHistory() {
    try {
      localStorage.setItem(this.HISTORY_KEY, JSON.stringify(this.watchHistory));
    } catch (e) {
      console.warn('Failed to save history:', e);
    }
  }

  isInHistory(videoId) {
    return this.watchHistory.some(item => item.id === videoId);
  }

  getAvailableVideos() {
    return videos.filter(video => !this.isInHistory(video.id));
  }

  updateHistoryUI() {
    const historyContent = document.getElementById('historyContent');
    if (!historyContent) return;
    if (this.watchHistory.length === 0) {
      historyContent.innerHTML = '<p style="opacity: 0.6;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
      return;
    }
    historyContent.innerHTML = this.watchHistory.map((item, index) => 
      `<div style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 14px;">
        <div style="font-weight: bold;">${index + 1}. ${item.title}</div>
        <div style="opacity: 0.6; font-size: 12px;">${new Date(item.timestamp).toLocaleTimeString()}</div>
      </div>`
    ).join('');
  }

  showAutoplayDialog() {
    document.getElementById('autoplayDialog').style.display = 'block';
  }

  hideAutoplayDialog() {
    document.getElementById('autoplayDialog').style.display = 'none';
  }

  toggleHistoryWindow() {
    const historyWindow = document.getElementById('historyWindow');
    const isVisible = historyWindow.style.display !== 'none';
    historyWindow.style.display = isVisible ? 'none' : 'block';
    if (!isVisible) this.updateHistoryUI();
  }

  // –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
  canGoBack() {
    return this.historyPosition < this.watchHistory.length - 1;
  }

  goBackInHistory() {
    if (!this.canGoBack()) {
      console.log('No more history, will do random selection without cache');
      return null; // –ù—É–ª–ª –æ–∑–Ω–∞—á–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä
    }
    
    // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ)
    if (this.historyPosition === 0 && this.watchHistory.length > 0) {
      this.watchHistory.shift(); // –£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç (—Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ)
      this.saveHistory();
      this.updateHistoryUI();
    } else {
      this.historyPosition++;
    }
    
    if (this.historyPosition >= this.watchHistory.length) {
      console.log('Reached end of history, will do random selection without cache');
      return null;
    }
    
    const previousVideo = this.watchHistory[this.historyPosition];
    console.log(`Going back in history to position ${this.historyPosition}: ${previousVideo.title}`);
    return previousVideo;
  }

  removeCurrentFromHistory() {
    // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
    if (this.historyPosition === 0 && this.watchHistory.length > 0) {
      const removed = this.watchHistory.shift();
      console.log(`Removed current video from history: ${removed.title}`);
      this.saveHistory();
      this.updateHistoryUI();
      return removed;
    }
    return null;
  }
}

const playerSettings = new VideoPlayerSettings();

// Now expose all constants to window for tests
window.MAX_VIDEOS_BEFORE_RECREATE = MAX_VIDEOS_BEFORE_RECREATE;
window.MAX_CONSECUTIVE_FAILURES = MAX_CONSECUTIVE_FAILURES;
window.VIDEO_LOAD_TIMEOUT = VIDEO_LOAD_TIMEOUT;
window.WATCHDOG_CHECK_INTERVAL = WATCHDOG_CHECK_INTERVAL;

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏
function logMemoryUsage() {
  if (performance.memory) {
    const memory = performance.memory;
    const used = Math.round(memory.usedJSHeapSize / 1024 / 1024);
    const total = Math.round(memory.totalJSHeapSize / 1024 / 1024);
    const limit = Math.round(memory.jsHeapSizeLimit / 1024 / 1024);
    console.log(`Memory: ${used}MB / ${total}MB (limit: ${limit}MB) - Video: ${videoChangeCount}`);
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
    if (used > limit * 0.8) {
      console.warn('Memory usage high, forcing player recreation');
      videoChangeCount = MAX_VIDEOS_BEFORE_RECREATE - 1; // –ó–∞—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–¥–µ–æ
    }
  }
}

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞
function forceGarbageCollection() {
  if (window.gc) {
    window.gc();
    console.log('Manual garbage collection triggered');
  }
}

// Watchdog –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ç–∏—Ö–∏—Ö –∑–∞–≤–∏—Å–∞–Ω–∏–π
function startWatchdog() {
  stopWatchdog();
  lastCurrentTime = -1;
  stuckTimeCount = 0;
  missingVideoCount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ –≤–∏–¥–µ–æ
  
  // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–æ–∫
  const interval = consecutiveFailures > 0 ? WATCHDOG_FAST_INTERVAL : WATCHDOG_CHECK_INTERVAL;
  console.log(`Starting watchdog with ${interval}ms interval (failures: ${consecutiveFailures})`);
  
  watchdogInterval = setInterval(() => {
    if (!player || isRecovering) return;
    
    try {
      const currentTime = player.currentTime || 0;
      const duration = player.duration || 0;
      const isPaused = player.paused;
      const hasEnded = player.ended;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç–∞
      const videoElement = player.media;
      const hasVideoElement = videoElement && videoElement.tagName;
      const videoVisible = hasVideoElement && videoElement.videoWidth > 0 && videoElement.videoHeight > 0;
      
      // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö)
      const hasVideoIssue = !videoVisible && currentTime > 0 && !isPaused;
      if (hasVideoIssue || stuckTimeCount > 0 || zeroTimeCount > 0) {
        console.log(`Watchdog: time=${Math.round(currentTime)}s, duration=${Math.round(duration)}s, paused=${isPaused}, ended=${hasEnded}, stuck=${stuckTimeCount}, video=${videoVisible}, missing=${missingVideoCount}`);
        
        if (hasVideoIssue) {
          // –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç–∞
          const iframe = document.querySelector('iframe');
          console.log(`Video diagnostics: element=${!!videoElement}, iframe=${!!iframe}, width=${videoElement?.videoWidth || 0}, height=${videoElement?.videoHeight || 0}`);
        }
      }
      
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å–ª–∏ –≤–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
      if (hasEnded) {
        console.log('Video ended normally, stopping watchdog');
        return;
      }
      
      // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ –∑–≤—É–∫) - —É–º–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
      if (hasVideoElement && !videoVisible && currentTime > 0 && !isPaused) {
        missingVideoCount++;
        console.warn(`Video disappeared but audio continues - likely postMessage issue (count: ${missingVideoCount})`);
        
        // –ù–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–±–µ–∑ –∑–∞–∏–∫–∞–Ω–∏—è)
        if (missingVideoCount === 2) {
          // –õ–µ–≥–∫–æ–µ CSS –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
          console.log('Gentle CSS refresh to restore video');
          tryRestoreVideoDisplay();
        } else if (missingVideoCount === 4) {
          // –û—Ç–º–µ—á–∞–µ–º —á—Ç–æ –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä
          console.log('Video recovery needed - will fix during next video transition');
          needsPlayerRecovery = true;
        } else if (missingVideoCount >= 8) {
          // –ö—Ä–∞–π–Ω—è—è –º–µ—Ä–∞ - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–≤—É–∫ —Ç–æ–∂–µ –ø—Ä–æ–ø–∞–ª)
          if (currentTime <= 0 || isPaused) {
            console.warn('Audio also failed, switching to next video');
            handleVideoFailure('missing_video_element');
            return;
          } else {
            console.log('Audio still playing - keeping current video, will recover on transition');
            needsPlayerRecovery = true;
          }
        }
        return;
      } else {
        if (missingVideoCount > 0) {
          const recoveryMethod = missingVideoCount >= 4 ? 'iframe recreation' : 
                                missingVideoCount >= 2 ? 'CSS refresh' : 'self-recovery';
          console.log(`‚úÖ Video element restored after ${missingVideoCount} missing checks using ${recoveryMethod}`);
        }
        missingVideoCount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –µ—Å–ª–∏ –≤–∏–¥–µ–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—â–∏—Ö—Å—è –≤–∏–¥–µ–æ
      if (!isPaused && duration > 0) {
        // –û—Å–æ–±–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è currentTime = 0 (—á–∞—Å—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ –∑–∞–≤–∏—Å–∞–Ω–∏—è)
        if (currentTime === 0) {
          zeroTimeCount++;
          console.warn(`Video stuck at 0s - not starting (check ${zeroTimeCount}/${MAX_ZERO_TIME_CHECKS})`);
          
          if (zeroTimeCount >= MAX_ZERO_TIME_CHECKS) {
            console.error('Video never started! Triggering recovery...');
            handleVideoFailure('watchdog_never_started');
            return;
          }
        } else {
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω—É–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
          if (zeroTimeCount > 0) {
            console.log('Video started playing, resetting zero-time counter');
            zeroTimeCount = 0;
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ã—á–Ω–æ–µ –∑–∞—Å—Ç—Ä—è–≤–∞–Ω–∏–µ
          if (lastCurrentTime >= 0 && Math.abs(lastCurrentTime - currentTime) < 0.5) { // –ú–∞–ª–µ–Ω—å–∫–∏–µ —Å–¥–≤–∏–≥–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã
            stuckTimeCount++;
            console.warn(`Video seems stuck at ${Math.round(currentTime)}s (check ${stuckTimeCount}/${MAX_STUCK_CHECKS})`);
            
            if (stuckTimeCount >= MAX_STUCK_CHECKS) {
              console.error('Video stuck detected! Triggering recovery...');
              handleVideoFailure('watchdog_stuck');
              return;
            }
          } else {
            if (stuckTimeCount > 0) {
              console.log('Video progress resumed, resetting stuck counter');
              stuckTimeCount = 0;
            }
          }
        }
        lastCurrentTime = currentTime;
      } else if (isPaused) {
        // –ü—Ä–∏ –ø–∞—É–∑–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ - –ø–∞—É–∑–∞ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
        if (stuckTimeCount > 0) {
          console.log('Video is paused, resetting stuck counter');
          stuckTimeCount = 0;
        }
      }
      
    } catch (error) {
      console.error('Watchdog error:', error);
      handleVideoFailure('watchdog_error');
    }
  }, interval);
  
  console.log(`Watchdog started with ${interval}ms interval`);
}

function stopWatchdog() {
  if (watchdogInterval) {
    clearInterval(watchdogInterval);
    watchdogInterval = null;
    console.log('Watchdog stopped');
  }
  lastCurrentTime = -1;
  stuckTimeCount = 0;
  zeroTimeCount = 0;
}

// –§—É–Ω–∫—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ –≤–∏–¥–µ–æ (–º—è–≥–∫–∞—è –≤–µ—Ä—Å–∏—è)
function tryRestoreVideoDisplay() {
  try {
    const iframe = document.querySelector('iframe');
    
    console.log('üîß Gentle CSS refresh to restore video (no interruption)');
    
    if (iframe) {
      // –û—á–µ–Ω—å –º—è–≥–∫–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ - —Ç–æ–ª—å–∫–æ CSS —Å—Ç–∏–ª–∏
      // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º display:none - —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
      
      // –ú–µ—Ç–æ–¥ 1: –õ–µ–≥–∫–∞—è opacity –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è
      const currentOpacity = iframe.style.opacity || '1';
      iframe.style.opacity = '0.99';
      
      setTimeout(() => {
        iframe.style.opacity = currentOpacity;
        
        // –ú–µ—Ç–æ–¥ 2: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π transform –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
        iframe.style.transform = 'translate3d(0.1px,0,0)';
        
        setTimeout(() => {
          iframe.style.transform = '';
          console.log('‚ú® Gentle refresh completed');
        }, 20);
      }, 10);
    }
  } catch (e) {
    console.warn('Gentle CSS refresh failed:', e);
  }
}

function tryRecreateIframe() {
  try {
    if (!player) return;
    
    const currentTime = player.currentTime || 0;
    const isPlaying = !player.paused;
    
    console.log(`Recreating iframe at ${currentTime}s, playing: ${isPlaying}`);
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    const currentSource = player.source;
    if (!currentSource) return;
    
    // –ù–ï –°–¢–ê–í–ò–ú –ù–ê –ü–ê–£–ó–£! –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
    console.log('Forcing source reload to fix iframe');
    
    // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
    player.source = currentSource;
    
    // –ü—Ä–æ—Å—Ç–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    setTimeout(() => {
      try {
        if (currentTime > 5 && player.currentTime !== undefined) {
          console.log(`Restoring position to ${currentTime}s`);
          player.currentTime = currentTime;
        }
        
        // –ï—Å–ª–∏ –±—ã–ª–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ, –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
        if (isPlaying) {
          setTimeout(() => {
            if (player.paused && player.play) {
              console.log('Resuming playback after iframe fix');
              player.play().catch(e => console.warn('Resume failed:', e));
            }
          }, 1000);
        }
      } catch (e) {
        console.warn('State restoration failed:', e);
      }
    }, 800); // –î–∞–µ–º –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
    
  } catch (e) {
    console.warn('Iframe recreation failed:', e);
  }
}

function tryFullPlayerRecreation() {
  try {
    if (!player) return;
    
    const currentTime = player.currentTime || 0;
    const isPlaying = !player.paused;
    const currentVideo = videos[currentIndex];
    
    console.log(`Full player recreation at ${currentTime}s for video ${currentVideo?.id}`);
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º watchdog
    stopWatchdog();
    
    // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –ø–ª–µ–µ—Ä –±–µ–∑ —Å–º–µ–Ω—ã –≤–∏–¥–µ–æ
    destroyPlayer(false); // –ú—è–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
    
    setTimeout(() => {
      player = createPlayer();
      if (player) {
        setupPlayerEvents();
        syncWindowVariables();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ –∂–µ –≤–∏–¥–µ–æ
        setVideoSource(currentVideo);
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        const restoreState = () => {
          setTimeout(() => {
            if (player.currentTime !== undefined && currentTime > 5) {
              player.currentTime = currentTime;
            }
            if (isPlaying && player.play) {
              player.play().catch(e => console.warn('Resume after recreation failed:', e));
            }
          }, 1000);
        };
        
        if (player.on) {
          player.once('ready', restoreState);
        } else {
          setTimeout(restoreState, 2000);
        }
      }
    }, 500);
    
  } catch (e) {
    console.warn('Full player recreation failed:', e);
  }
}

function getRandomInt(max) {
  return Math.floor(Math.random() * max);
}

function createPlayer() {
  try {
    if (!container) {
      console.error('Container element not found!');
      return null;
    }
    
    console.log('Creating new Plyr player...');
    const newPlayer = new Plyr(container, { 
      autoplay: playerSettings.autoplayAllowed === true, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      controls: ['play', 'progress', 'mute', 'volume', 'fullscreen'],
      clickToPlay: true
    });
    
    if (newPlayer) {
      console.log('Plyr player created successfully');
    }
    
    return newPlayer;
  } catch (error) {
    console.error('Failed to create player:', error);
    return null;
  }
}

function destroyPlayer(forceful = false) {
  stopWatchdog();
  clearVideoTimeout();
  
  if (player) {
    try {
      player.off('ended');
      player.off('ready');
      player.off('play');
      player.off('pause');
      player.off('playing');
      player.off('error');
      player.off('loadstart');
      player.off('canplay');
      player.off('stalled');
      player.off('waiting');
      player.destroy();
    } catch (e) {
      console.warn('Error destroying player:', e);
    }
    player = null;
  }
  
  // –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ iframe —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º —Å–±—Ä–æ—Å–µ
  if (forceful) {
    console.log('Forceful cleanup - removing all iframes');
    const iframes = document.querySelectorAll('iframe');
    iframes.forEach((iframe, index) => {
      try {
        // –ú—è–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        setTimeout(() => {
          if (iframe.contentWindow && iframe.contentWindow.YT) {
            iframe.contentWindow.YT = null;
          }
          iframe.src = 'about:blank';
          setTimeout(() => {
            iframe.parentNode && iframe.parentNode.removeChild(iframe);
          }, 100);
        }, index * 50); // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª—è–µ–º
      } catch (e) {
        console.warn('Error cleaning iframe:', e);
      }
    });
    
    setTimeout(() => {
      container.innerHTML = '';
      container.className = '';
      forceGarbageCollection();
      container.innerHTML = '<div data-plyr-provider="youtube" data-plyr-embed-id=""></div>';
    }, 500);
  } else {
    // –ú—è–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ - –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    console.log('Gentle cleanup - preserving iframes');
    setTimeout(() => {
      container.innerHTML = '<div data-plyr-provider="youtube" data-plyr-embed-id=""></div>';
    }, 100);
  }
}

function loadVideo(index) { // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–µ–æ
  const video = videos[index];
  videoChangeCount++;
  
  // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –ø–ª–µ–µ—Ä –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–∞–º—è—Ç–∏
  if (!player || videoChangeCount % MAX_VIDEOS_BEFORE_RECREATE === 0) {
    console.log('Recreating player for memory cleanup...'); 
    const needsForcefulCleanup = consecutiveFailures > 1 || videoChangeCount % (MAX_VIDEOS_BEFORE_RECREATE * 2) === 0;
    destroyPlayer(needsForcefulCleanup);
    
    const delay = needsForcefulCleanup ? 1500 : 800; // –£–≤–µ–ª–∏—á–∏–ª–∏ –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
    setTimeout(() => {
      console.log('Attempting to recreate player...');
      player = createPlayer();
      if (player) {
        console.log('Player recreated successfully');
        setupPlayerEvents();
        syncWindowVariables();
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –≤–∏–¥–µ–æ
        setTimeout(() => {
          setVideoSource(video);
        }, 300);
      } else {
        console.error('Failed to recreate player, triggering recovery');
        handleVideoFailure('player_creation_failed');
      }
    }, delay);
    return;
  }
  
  setVideoSource(video);
}

function setVideoSource(video) {
  lastProvider = video.type;
  stopWatchdog(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π watchdog
  
  const videoTitle = videos.find(v => v.id === video.id)?.title || video.id;
  console.log(`Loading ${video.type === 'yt' ? 'YouTube' : 'Vimeo'} video: ${videoTitle} (${video.id}) - failures: ${consecutiveFailures}, stuck: ${stuckTimeCount}`);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ - –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è!
  if (needsPlayerRecovery) {
    console.log('‚öôÔ∏è Performing delayed player recovery during video transition');
    needsPlayerRecovery = false;
    
    // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –ø–ª–µ–µ—Ä —á–∏—Å—Ç–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    destroyPlayer(false); // –ú—è–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
    
    setTimeout(() => {
      player = createPlayer();
      if (player) {
        console.log('‚úÖ Player recovered successfully during transition');
        setupPlayerEvents();
        syncWindowVariables();
        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –≤–∏–¥–µ–æ
        actuallySetVideoSource(video);
      } else {
        console.error('Player recovery failed, using existing player');
        actuallySetVideoSource(video);
      }
    }, 300);
    return;
  }
  
  // –û–±—ã—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
  actuallySetVideoSource(video);
}

function actuallySetVideoSource(video) {
  try {
    if (video.type === 'yt') {
      player.source = {
        type: 'video',
        sources: [{
          src: video.id,
          provider: 'youtube',
        }],
      };
    } else if (video.type === 'vi') {
      player.source = {
        type: 'video',
        sources: [{
          src: video.id,
          provider: 'vimeo',
        }],
      };
    }
    
    startVideoTimeout();
    
    // –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ —Å–æ–±—ã—Ç–∏–µ 'ready' –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    console.log('Video source set, waiting for ready event to start playback');
    
  } catch (error) {
    console.error('Error setting video source:', error);
    handleVideoFailure('source_error');
  }
}

function getNextVideoIndex() {
  // –ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö –ø–æ–¥—Ä—è–¥, –ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
  if (consecutiveFailures >= 2 && lastProvider) {
    const availableVideos = playerSettings.getAvailableVideos().filter(v => v.type !== lastProvider);
    if (availableVideos.length > 0) {
      console.log('Multiple failures, trying different provider from available videos');
      const randomAlt = availableVideos[getRandomInt(availableVideos.length)];
      return videos.indexOf(randomAlt);
    }
  }
  
  // –í—ã–±–∏—Ä–∞–µ–º –∏–∑ –≤–∏–¥–µ–æ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  const availableVideos = playerSettings.getAvailableVideos();
  
  if (availableVideos.length === 0) {
    console.log('All videos watched, clearing history and starting fresh');
    playerSettings.watchHistory = [];
    playerSettings.saveHistory();
    return getRandomInt(videos.length);
  }
  
  console.log(`Choosing from ${availableVideos.length} unwatched videos (${playerSettings.watchHistory.length} in history)`);
  
  let newIndex;
  do {
    const randomVideo = availableVideos[getRandomInt(availableVideos.length)];
    newIndex = videos.indexOf(randomVideo);
  } while (newIndex === currentIndex && availableVideos.length > 1);
  
  return newIndex;
}

function clearVideoTimeout() {
  if (currentVideoTimeout) {
    clearTimeout(currentVideoTimeout);
    currentVideoTimeout = null;
  }
}

function startVideoTimeout() {
  clearVideoTimeout();
  currentVideoTimeout = setTimeout(() => {
    console.warn('Video load timeout, trying next video');
    handleVideoFailure('timeout');
  }, VIDEO_LOAD_TIMEOUT);
}

function handleVideoFailure(reason) {
  if (isRecovering) return;
  
  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º reason –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  const reasonStr = typeof reason === 'string' ? reason : (reason ? reason.toString() : 'unknown');
  
  consecutiveFailures++;
  syncWindowVariables();
  console.error(`Video failure (${reasonStr}). Consecutive failures: ${consecutiveFailures}`);
  
  clearVideoTimeout();
  stopWatchdog();
  isRecovering = true;
  
  const isWatchdogFailure = reasonStr.includes('watchdog');
  const forceRecreation = consecutiveFailures >= MAX_CONSECUTIVE_FAILURES || isWatchdogFailure;
  
  if (forceRecreation) {
    console.warn(`${isWatchdogFailure ? 'Watchdog failure' : 'Too many consecutive failures'}, forcing player recreation`);
    videoChangeCount = MAX_VIDEOS_BEFORE_RECREATE - 1;
    consecutiveFailures = 0;
    syncWindowVariables();
  }
  
  const delay = isWatchdogFailure ? 500 : 2000;
  setTimeout(() => {
    currentIndex = getNextVideoIndex();
    syncWindowVariables();
    loadVideo(currentIndex);
    isRecovering = false;
  }, delay);
}

function handleVideoSuccess() {
  consecutiveFailures = 0;
  syncWindowVariables();
  clearVideoTimeout();
  isRecovering = false;
  stuckTimeCount = 0;
  zeroTimeCount = 0;
  missingVideoCount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ –≤–∏–¥–µ–æ
  needsPlayerRecovery = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
  
  // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ –≤ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  if (currentIndex >= 0 && currentIndex < videos.length) {
    const video = videos[currentIndex];
    const title = video.title || `${video.type === 'yt' ? 'YouTube' : 'Vimeo'}: ${video.id}`;
    playerSettings.addToHistory(video.id, title);
  }
}

function setupPlayerEvents() {
  if (!player) {
    console.warn('Cannot setup player events: player is null');
    return;
  }
  
  // –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Å–æ–±—ã—Ç–∏–π
  function safeEventHandler(eventName, handler) {
    return function(...args) {
      try {
        handler.apply(this, args);
      } catch (e) {
        if (e.message && e.message.includes('postMessage')) {
          console.warn(`PostMessage error in ${eventName} event, ignoring:`, e.message);
        } else if (e.message && (e.message.includes('catch') || e.message.includes('play'))) {
          // –û—à–∏–±–∫–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è - –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ
          console.warn(`Autoplay error in ${eventName} event, ignoring:`, e.message);
        } else {
          console.error(`Error in ${eventName} event:`, e);
          // –¢–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫, –Ω–µ –¥–ª—è ready
          if (eventName !== 'ready') {
            handleVideoFailure(`event_${eventName}_error`);
          }
        }
      }
    };
  }

  player.on('ended', safeEventHandler('ended', function () {
    const currentTime = player.currentTime || 0;
    const duration = player.duration || 0;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –Ω–µ –ª–æ–∂–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ ended –≤ –Ω–∞—á–∞–ª–µ –≤–∏–¥–µ–æ
    if (currentTime < 5 && duration > 30) {
      console.warn(`Ignoring premature 'ended' event at ${currentTime}s of ${duration}s video - likely YouTube API glitch`);
      return;
    }
    
    console.log(`Video ended normally at ${currentTime}s/${duration}s`);
    stopWatchdog();
    handleVideoSuccess();
    currentIndex = getNextVideoIndex();
    syncWindowVariables();
    loadVideo(currentIndex);
  }));

  player.on('ready', safeEventHandler('ready', function () {
    console.log('Player ready, starting playback');
    handleVideoSuccess();
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è iframe —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(() => {
      const iframe = document.querySelector('iframe');
      if (iframe) {
        console.log('YouTube iframe detected, ensuring proper initialization');
        // –î–∞–µ–º iframe –≤—Ä–µ–º—è –Ω–∞ –ø–æ–ª–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
        setTimeout(() => {
          tryAutoplayIfAllowed();
        }, 300);
      } else {
        // –ï—Å–ª–∏ iframe –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å—Ä–∞–∑—É
        tryAutoplayIfAllowed();
      }
    }, 100);
    
    function tryAutoplayIfAllowed() {
      // –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
      if (playerSettings.autoplayAllowed === true && player && player.play) {
        // –î–∞–µ–º –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—é, –æ—Å–æ–±–µ–Ω–Ω–æ Safari
        const autoplayDelay = isSafari ? 800 : 400;
        
        setTimeout(() => {
          try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–ª–µ–µ—Ä –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
            if (player && player.play && player.paused && !isRecovering) {
              console.log(`Starting autoplay after ${autoplayDelay}ms delay`);
              
              const playPromise = player.play();
              if (playPromise && playPromise.catch) {
                playPromise.catch(e => {
                  const errorMsg = e.message || e.toString();
                  if (isSafari && errorMsg.includes('user interaction')) {
                    console.warn('Safari requires user interaction for autoplay');
                  } else if (errorMsg.includes('NotAllowedError')) {
                    console.warn('Autoplay blocked by browser policy');
                  } else {
                    console.warn('Autoplay failed:', errorMsg);
                  }
                });
              }
            } else {
              console.log('Player already playing or unavailable, skipping autoplay');
            }
          } catch (e) {
            console.warn('Error during delayed autoplay:', e);
          }
        }, autoplayDelay);
      } else if (playerSettings.autoplayAllowed === false) {
        console.log('Autoplay disabled by user preference');
      } else {
        console.log('Autoplay preference not set yet');
      }
    }
  }));
  
  player.on('error', safeEventHandler('error', function (e) {
    console.error('Player error:', e);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–æ–π
    const errorMessage = e?.detail?.message || e?.message || '';
    const errorName = e?.detail?.name || '';
    
    // –ù–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ - –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
    if (errorName === 'PlayInterrupted' || 
        errorMessage.includes('interrupted by a call to pause') ||
        errorMessage.includes('play() request was interrupted')) {
      console.warn('Non-critical player error, ignoring:', errorMessage);
      return;
    }
    
    // –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–µ–æ
    stopWatchdog();
    handleVideoFailure('player_error');
  }));
  
  player.on('loadstart', safeEventHandler('loadstart', function () {
    console.log('Video loading started');
    stopWatchdog();
    startVideoTimeout();
  }));
  
  player.on('canplay', safeEventHandler('canplay', function () {
    console.log('Video can start playing');
    clearVideoTimeout();
  }));
  
  player.on('playing', safeEventHandler('playing', function () {
    console.log('Video is playing - starting watchdog');
    handleVideoSuccess();
    startWatchdog();
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è YouTube iframe
    setTimeout(() => {
      const iframe = document.querySelector('iframe');
      if (iframe && iframe.style.opacity !== '1') {
        console.log('Ensuring iframe visibility after play start');
        iframe.style.opacity = '1';
      }
    }, 500);
  }));
  
  player.on('pause', safeEventHandler('pause', function () {
    const currentTime = player.currentTime || 0;
    if (currentTime > 1) { // –õ–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –Ω–∞—á–∞–ª–æ –≤–∏–¥–µ–æ
      console.log(`Video paused at ${Math.round(currentTime)}s`);
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–∞—É–∑–∞ –Ω–µ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ YouTube iframe
    if (currentTime === 0 && playerSettings.autoplayAllowed === true) {
      console.warn('Video paused at start - might be YouTube iframe issue');
      setTimeout(() => {
        const iframe = document.querySelector('iframe');
        if (iframe && player && player.paused) {
          console.log('Attempting to fix paused YouTube iframe');
          // –õ–µ–≥–∫–∏–π —Ä–µ—Ñ—Ä–µ—à iframe –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
          iframe.style.transform = 'translate3d(0,0,0)';
          setTimeout(() => {
            iframe.style.transform = '';
          }, 50);
        }
      }, 1000);
    }
  }));
  
  player.on('stalled', safeEventHandler('stalled', function () {
    console.warn('Video stalled - watchdog will handle if needed');
  }));
  
  player.on('waiting', safeEventHandler('waiting', function () {
    console.warn('Video waiting for data');
  }));
}

// –ú–∞–Ω—É–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ (–ø—Ä–æ–±–µ–ª –∏–ª–∏ –∫–ª–∏–∫)
function forceNextVideo() {
  console.log('Manual skip triggered');
  clearVideoTimeout();
  stopWatchdog();
  consecutiveFailures = Math.max(0, consecutiveFailures - 1);
  isRecovering = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
  currentIndex = getNextVideoIndex();
  syncWindowVariables();
  loadVideo(currentIndex);
}

// –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
function togglePlayPause() {
  if (!player) {
    console.warn('Player not available for play/pause');
    return;
  }
  
  try {
    if (player.paused) {
      player.play();
      console.log('Video resumed');
    } else {
      player.pause();
      console.log('Video paused');
    }
  } catch (error) {
    console.warn('Error toggling play/pause:', error);
  }
}

function loadRandomVideo() {
  console.log('Random video selection triggered');
  clearVideoTimeout();
  stopWatchdog();
  consecutiveFailures = Math.max(0, consecutiveFailures - 1);
  isRecovering = false;
  currentIndex = getNextVideoIndex();
  syncWindowVariables();
  loadVideo(currentIndex);
}

function goBackInHistory() {
  console.log('Going back in history');
  const previousVideo = playerSettings.goBackInHistory();
  
  if (previousVideo === null) {
    // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, –¥–µ–ª–∞–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ –∫—ç—à
    console.log('History ended, doing random selection without caching');
    clearVideoTimeout();
    stopWatchdog();
    consecutiveFailures = Math.max(0, consecutiveFailures - 1);
    isRecovering = false;
    
    // –°–ª—É—á–∞–π–Ω—ã–π –∏–Ω–¥–µ–∫—Å –±–µ–∑ —É—á–µ—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
    currentIndex = getRandomInt(videos.length);
    syncWindowVariables();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ –±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é
    const videoId = videos[currentIndex].type === 'yt' ? 
      videos[currentIndex].id : 
      `vimeo-${videos[currentIndex].id}`;
      
    setVideoSource(videos[currentIndex]);
    console.log(`Loading random video without cache: ${videoId}`);
    return;
  }
  
  // –ò—â–µ–º –≤–∏–¥–µ–æ –ø–æ ID –≤ –æ–±—â–µ–º —Å–ø–∏—Å–∫–µ
  const videoIndex = videos.findIndex(video => {
    const videoId = video.type === 'yt' ? video.id : `vimeo-${video.id}`;
    return videoId === previousVideo.id;
  });
  
  if (videoIndex !== -1) {
    clearVideoTimeout();
    stopWatchdog();
    isRecovering = false;
    currentIndex = videoIndex;
    syncWindowVariables();
    setVideoSource(videos[currentIndex]);
    console.log(`Loaded video from history: ${previousVideo.title}`);
  } else {
    console.warn(`Video from history not found in videos array: ${previousVideo.id}`);
    // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª—É—á–∞–π–Ω–æ–º—É
    loadRandomVideo();
  }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∫–∞–∂–¥—ã–µ –º–∏–Ω—É—Ç—É
function healthCheck() {
  if (player && !isRecovering) {
    const currentTime = player.currentTime;
    const duration = player.duration;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞—Å—Ç—Ä—è–ª–æ –ª–∏ –≤–∏–¥–µ–æ
    if (currentTime > 0 && currentTime === player._lastHealthCheckTime && !player.paused) {
      console.warn('Video seems stuck, forcing next video');
      handleVideoFailure('health_check_stuck');
      return;
    }
    
    player._lastHealthCheckTime = currentTime;
    
    // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if (currentTime > 0 && duration > 0) {
      const progress = Math.round((currentTime / duration) * 100);
      console.log(`Playback health: ${progress}% (${Math.round(currentTime)}s/${Math.round(duration)}s)`);
    }
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (—Å —É–ª—É—á—à–µ–Ω–Ω–æ–π Safari –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π)
document.addEventListener('keydown', function(e) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∞–≤–∏—à–∞ –Ω–∞–∂–∞—Ç–∞ –Ω–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
    return; // –ù–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–ª–∞–≤–∏—à–∏ –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
  }
  
  // –ü—Ä–æ–±–µ–ª - pause/play (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏ code –∏ key –¥–ª—è Safari)
  if (e.code === 'Space' || e.key === ' ') {
    e.preventDefault();
    togglePlayPause();
    return;
  }
  
  // –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ - —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä
  if (e.key === 'ArrowRight' || e.keyCode === 39) {
    e.preventDefault();
    loadRandomVideo();
    return;
  }
  
  // –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ - –Ω–∞–∑–∞–¥ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
  if (e.key === 'ArrowLeft' || e.keyCode === 37) {
    e.preventDefault();
    goBackInHistory();
    return;
  }
  
  // N - —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ (–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  if (e.key === 'n' || e.key === 'N' || e.keyCode === 78) {
    e.preventDefault();
    forceNextVideo();
    return;
  }
  
  // H - —Ç–æ–≥–≥–ª –∏—Å—Ç–æ—Ä–∏–∏
  if (e.key === 'h' || e.key === 'H') {
    e.preventDefault();
    playerSettings.toggleHistoryWindow();
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
  const autoplayAllow = document.getElementById('autoplayAllow');
  const autoplayDeny = document.getElementById('autoplayDeny');
  const toggleHistory = document.getElementById('toggleHistory');

  if (autoplayAllow) {
    autoplayAllow.addEventListener('click', function() {
      playerSettings.setAutoplayPreference(true);
      playerSettings.hideAutoplayDialog();
      console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∏–ª –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ');
      
      // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º –ø–ª–µ–µ—Ä —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ —Å—Ä–∞–∑—É –∑–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ
      if (player) {
        destroyPlayer(false);
        setTimeout(() => {
          player = createPlayer();
          if (player) {
            setupPlayerEvents();
            syncWindowVariables(); // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
            
            // –î–∞–µ–º –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
            const videoToLoad = videos[currentIndex] || videos[0];
            if (videoToLoad) {
              console.log('Loading video after autoplay permission granted:', videoToLoad.id);
              setTimeout(() => {
                setVideoSource(videoToLoad);
              }, 1000); // –£–≤–µ–ª–∏—á–∏–ª–∏ —Å 200 –¥–æ 1000–º—Å
            }
          } else {
            console.error('Failed to recreate player after autoplay permission');
          }
        }, 800); // –£–≤–µ–ª–∏—á–∏–ª–∏ —Å 300 –¥–æ 800–º—Å
      } else {
        // –ï—Å–ª–∏ –ø–ª–µ–µ—Ä–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º —Å –Ω—É–ª—è
        initializePlayer();
      }
    });
  }

  if (autoplayDeny) {
    autoplayDeny.addEventListener('click', function() {
      playerSettings.setAutoplayPreference(false);
      playerSettings.hideAutoplayDialog();
      console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ');
      
      // –¢–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ, –Ω–æ –±–µ–∑ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
      if (player && videos.length > 0) {
        const videoToLoad = videos[currentIndex] || videos[0];
        if (videoToLoad) {
          console.log('Loading video without autoplay:', videoToLoad.id);
          setTimeout(() => {
            setVideoSource(videoToLoad);
          }, 200);
        }
      } else if (!player) {
        // –ï—Å–ª–∏ –ø–ª–µ–µ—Ä–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º
        initializePlayer();
      }
    });
  }

  if (toggleHistory) {
    toggleHistory.addEventListener('click', function() {
      playerSettings.toggleHistoryWindow();
    });
  }
});

// –ö–ª–∏–∫ –ø–æ —ç–∫—Ä–∞–Ω—É –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–µ–æ –û–¢–ö–õ–Æ–ß–ï–ù –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
/*
document.addEventListener('click', function(e) {
  if (!e.target.closest('.plyr__controls')) {
    forceNextVideo();
  }
});
*/

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º Safari –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
const isWebKit = /webkit/i.test(navigator.userAgent) && !/chrome/i.test(navigator.userAgent);
console.log(`Browser detection: Safari=${isSafari}, WebKit=${isWebKit}`);

// –ü–µ—Ä–µ—Ö–≤–∞—Ç postMessage –æ—à–∏–±–æ–∫ (—Å —É–ª—É—á—à–µ–Ω–Ω–æ–π Safari –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π)
let postMessageErrorCount = 0;
window.addEventListener('error', function(e) {
  const errorMessage = e.message || '';
  if (errorMessage.includes('postMessage') || errorMessage.includes('cross-origin') || 
      (isSafari && (errorMessage.includes('iframe') || errorMessage.includes('youtube')))) {
    postMessageErrorCount++;
    console.warn(`Caught ${isSafari ? 'Safari ' : ''}postMessage/CORS error #${postMessageErrorCount}, ignoring:`, errorMessage);
    
    // –í Safari –±—ã–≤–∞–µ—Ç –±–æ–ª—å—à–µ –æ—à–∏–±–æ–∫, –ø–æ—ç—Ç–æ–º—É –¥–∞–µ–º –±–æ–ª—å—à–µ —à–∞–Ω—Å–æ–≤
    const errorThreshold = isSafari ? 20 : 10;
    if (postMessageErrorCount > errorThreshold && player) {
      console.warn(`Too many ${isSafari ? 'Safari ' : ''}postMessage errors, switching to next video`);
      forceNextVideo();
      postMessageErrorCount = 0;
    }
    
    return true; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã–≤–∞–Ω–∏–µ
  }
});

// –ü–µ—Ä–µ—Ö–≤–∞—Ç unhandled promise rejections
window.addEventListener('unhandledrejection', function(e) {
  if (e.reason && e.reason.toString && (e.reason.toString().includes('postMessage') || e.reason.toString().includes('cross-origin'))) {
    postMessageErrorCount++;
    console.warn('Caught postMessage promise rejection, ignoring:', e.reason);
    e.preventDefault();
  }
});

// –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ postMessage –æ—à–∏–±–æ–∫
setInterval(() => {
  if (postMessageErrorCount > 0) {
    console.log(`Resetting postMessage error count (was: ${postMessageErrorCount})`);
    postMessageErrorCount = Math.max(0, postMessageErrorCount - 2); // –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º
  }
}, 30000); // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function initializePlayer() {
  console.log('Initializing player...');
  player = createPlayer();
  if (player) {
    setupPlayerEvents();
    syncWindowVariables(); // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
    if (playerSettings.autoplayAllowed !== null && videos.length > 0) {
      setTimeout(() => {
        console.log('Loading initial video after player setup');
        setVideoSource(videos[currentIndex] || videos[0]);
      }, 100);
    }
  } else {
    console.error('Failed to create initial player');
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
initializePlayer();

// Note: exposeFunctionsToWindow() moved to end of script after all functions are defined
syncWindowVariables();

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–ª
if (playerSettings.autoplayAllowed === null) {
  console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è');
  setTimeout(() => {
    playerSettings.showAutoplayDialog();
  }, 1000); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∏—Å—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –Ω–µ –ø—É—Å—Ç–∞
if (playerSettings.watchHistory.length > 0) {
  setTimeout(() => {
    const historyWindow = document.getElementById('historyWindow');
    if (historyWindow) {
      historyWindow.style.display = 'block';
      playerSettings.updateHistoryUI();
    }
  }, 2000);
}

loadVideo(currentIndex); // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–∏–¥–µ–æ

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
memoryCheckInterval = setInterval(logMemoryUsage, 30000);
logMemoryUsage(); // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
setInterval(healthCheck, 60000);

// Expose functions to window for testing - MUST be at the end after all functions are defined
exposeFunctionsToWindow();
</script></body></html>
